BootStrap: docker
From: tensorflow/tensorflow:2.17.0-gpu

%post
    # Update package list and install any additional packages if needed
    apt-get update && apt-get install -y \
        vim \
        git \
        wget \
        htop
    apt update
    apt install -y cmake
#    pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
#    pip3 install "git+https://github.com/facebookresearch/pytorch3d.git@stable"

#    cd /
#    mkdir a
#    pip3 install mkl-static mkl-include
#    wget https://icl.utk.edu/projectsfiles/magma/downloads/magma-2.8.0.tar.gz
#    tar -zxvf magma-2.8.0.tar.gz
#    cd magma-2.8.0
#    export CUDADIR=/usr/loca/cuda




    git clone --depth 1 --recursive https://github.com/pytorch/pytorch.git
    cd pytorch
    git submodule sync
    git submodule update --init --recursive
    pip3 install -r requirements.txt

    export CUDA_DIR=/usr/local/cuda-12.3
    git submodule sync
    git submodule update --init --recursive
    export CMAKE_PREFIX_PATH=${CONDA_PREFIX:-"$(dirname $(which conda))/../"}





    # Clean up
#    apt-get clean && rm -rf /var/lib/apt/lists/*

%environment
    export LC_ALL=C
    export LANG=C
    export PATH=/usr/local/bin:$PATH

%runscript
    echo -e "This is a ML container created by Shah Rukh Qasim <shah.rukh.qasim@cern.ch>.\nContains 1) TensorFlow 2) PyTorch. Other packages can be installed via pip3 install <package>."
    exec /bin/bash

%labels
    Author Shah Rukh Qasim
    Version 1.7
    Description This Singularity container can be used to run ML applications based in TensorFlow or PyTorch

